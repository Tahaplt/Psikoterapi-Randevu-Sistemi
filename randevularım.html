<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Randevularım</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Randevularım</h1>
    <nav id="navLinks"></nav>
    <span id="liveClock"></span>
  </header>

  <main>
    <section id="randevuListesi" class="randevu-listesi">
      <p>Yükleniyor...</p>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Tüm Hakları Saklıdır</p>
  </footer>

  <script>
    const user = JSON.parse(localStorage.getItem("user"));
    const navLinks = document.getElementById("navLinks");
    const randevuListesi = document.getElementById("randevuListesi");

    if (user) {
      navLinks.innerHTML = `
        <span>Merhaba, ${user.name}</span>
        <a href="randevu.html">Randevu Al</a>
        ${user.role === "psikolog" ? '<a href="profile.html">Profilim</a>' : ''}
        <a href="#" id="logoutBtn">Çıkış Yap</a>
      `;
    } else {
      navLinks.innerHTML = `
        <a href="login.html">Giriş Yap</a>
        <a href="register.html">Kayıt Ol</a>
        <a href="login.html">Demo Giriş</a>
      `;
    }

    document.addEventListener("click", function (e) {
      if (e.target.id === "logoutBtn") {
        e.preventDefault();
        localStorage.removeItem("user");
        window.location.href = "login.html";
      }
    });

    if (!user) {
      randevuListesi.innerHTML = "<p>Lütfen önce giriş yapın.</p>";
    } else {
      const tumRandevular = JSON.parse(localStorage.getItem("demoAppointments") || "[]");
      const filtreli = tumRandevular.filter(r => {
        if (user.role === "danisan") return r.email === user.email;
        if (user.role === "psikolog") return r.psikolog === user.email;
        return false;
      });

      if (filtreli.length === 0) {
        randevuListesi.innerHTML = "<p>Henüz bir randevunuz bulunmuyor.</p>";
      } else {
        randevuListesi.innerHTML = "";
        filtreli.forEach(r => {
          const kart = document.createElement("div");
          kart.classList.add("randevu-karti");
          kart.innerHTML = `
            <strong>${r.date} - ${r.time}</strong><br>
            ${user.role === "danisan" ? `Psikolog: ${r.psikolog_name || r.psikolog}` : `Danışan: ${r.client_name}`}
          `;
          randevuListesi.appendChild(kart);
        });
      }
    }
  </script>

  <script src="script.js"></script>
</body>
</html>
