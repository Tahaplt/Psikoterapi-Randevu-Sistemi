<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Randevu Al</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Randevu Al</h1>
    <nav id="navLinks"></nav>
  </header>

  <main>
    <section id="psikologListesi" class="psikologlar"></section>

    <section class="randevu-formu">
      <h2>Randevu Al</h2>
      <form id="randevuForm">
        <label for="psikologSec">Psikolog Seç:</label>
        <select id="psikologSec" required>
          <option value="">Seçiniz</option>
        </select>

        <label for="tarih">Tarih:</label>
        <input type="date" id="tarih" required>

        <label for="saatSec">Saat:</label>
        <select id="saatSec" required>
          <option value="">Önce psikolog ve tarih seçin</option>
        </select>

        <button type="submit">Randevu Al</button>
      </form>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Tüm Hakları Saklıdır</p>
  </footer>

  <script>
    const user = JSON.parse(localStorage.getItem("user"));
    const navLinks = document.getElementById("navLinks");

    // NAVIGATION BAR
    if (user) {
      navLinks.innerHTML = `
        <span>Merhaba, ${user.name}</span>
        <a href="randevularım.html">Randevularım</a>
        ${user.role === "psikolog" ? '<a href="profile.html">Profilim</a>' : ''}
        <a href="#" id="logoutBtn">Çıkış Yap</a>
      `;
    } else {
      navLinks.innerHTML = `
        <a href="login.html">Giriş Yap</a>
        <a href="register.html">Kayıt Ol</a>
      `;
    }

    document.addEventListener("click", function (e) {
      if (e.target.id === "logoutBtn") {
        localStorage.removeItem("user");
        window.location.href = "login.html";
      }
    });

    // SABİT DEMO PSİKOLOGLAR
    const demoPsikologlar = [
      {
        name: "Mustafa Taha Polat",
        email: "taha@demo.com",
        age: 30,
        photo: "https://upload.wikimedia.org/wikipedia/commons/b/bc/Recep_Tayyip_Erdoğan_2023_%28cropped%29.jpg",
        specialty: ["Travma", "Aile Terapisi"],
        availableHours: ["09:00", "10:00", "11:00", "13:00", "14:00", "15:00", "16:00", "17:00"]
      }
      {
        name: "Bilal Kalender",
        email: "bilal@demo.com",
        age: 32,
        photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/68/Joe_Biden_presidential_portrait.jpg/440px-Joe_Biden_presidential_portrait.jpg",
        specialty: ["Aile terapisti", "Bağımlılık"],
        availableHours: ["09:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00"]
      }
    ];

    const psikologListesi = document.getElementById("psikologListesi");
    const selectPsikolog = document.getElementById("psikologSec");
    const selectSaat = document.getElementById("saatSec");

    // PSİKOLOGLARI GÖSTER
    demoPsikologlar.forEach(p => {
      // Kart gösterimi
      const card = document.createElement("div");
      card.classList.add("psikolog-karti");
      card.innerHTML = `
        <img src="${p.photo}" alt="${p.name}" width="100">
        <div>
          <strong>${p.name}</strong><br>
          Yaş: ${p.age}<br>
          Uzmanlık: ${p.specialty.join(", ")}<br>
          Uygun Saatler: ${p.availableHours.join(", ")}
        </div>
      `;
      psikologListesi.appendChild(card);

      // Seçim için dropdown'a ekle
      const option = document.createElement("option");
      option.value = p.email;
      option.textContent = p.name;
      selectPsikolog.appendChild(option);
    });

    // SAATLERİ GÜNCELLE
    selectPsikolog.addEventListener("change", () => {
      const selected = demoPsikologlar.find(p => p.email === selectPsikolog.value);
      if (!selected) return;
      selectSaat.innerHTML = `<option value="">Saat Seç</option>`;
      selected.availableHours.forEach(saat => {
        const opt = document.createElement("option");
        opt.value = saat;
        opt.textContent = saat;
        selectSaat.appendChild(opt);
      });
    });

    // FORM GÖNDERİMİ
    document.getElementById("randevuForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const psikologEmail = selectPsikolog.value;
      const date = document.getElementById("tarih").value;
      const time = selectSaat.value;

      if (!psikologEmail || !date || !time) return alert("Lütfen tüm alanları doldurun!");

      const psikolog = demoPsikologlar.find(p => p.email === psikologEmail);
      if (!psikolog) return;

      const demoRandevu = {
        id: Date.now(),
        email: user?.email || "demo@demo.com",
        client_name: user?.name || "Demo Danışan",
        psikolog: psikolog.email,
        psikolog_name: psikolog.name,
        date,
        time
      };

      const onceki = JSON.parse(localStorage.getItem("demoAppointments") || "[]");
      onceki.push(demoRandevu);
      localStorage.setItem("demoAppointments", JSON.stringify(onceki));

      alert("Randevu başarıyla oluşturuldu!");
      window.location.href = "randevularım.html";
    });
  </script>
</body>
</html>


